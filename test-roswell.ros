#!/bin/sh
#|-*- mode:lisp -*-|#
#|
exec ros -Q -- $0 "$@"
|#

;;;; Test script to verify MCP server loading

;; Load required systems
(ql:quickload '(:40ants-mcp :alexandria :local-time :40ants-slynk) :silent t)

(defpackage #:test-mcp
  (:use #:cl)
  (:import-from #:40ants-mcp/core
                #:mcp-server
                #:add-tool)
  (:import-from #:alexandria))
(in-package #:test-mcp)

(defun main (&rest argv)
  "Test that we can create an MCP server"
  (declare (ignore argv))
  
  (format t "Testing 40ants-mcp with Roswell...~%")
  (format t "Lisp: ~A ~A~%" 
          (lisp-implementation-type)
          (lisp-implementation-version))
  (format t "Roswell: ~A~%" 
          (or (uiop:getenv "ROSWELL_VERSION") "Unknown"))
  
  ;; Create a simple test server
  (let ((server (make-instance 'mcp-server
                               :name "Test Server"
                               :version "0.1.0")))
    
    ;; Add a test tool
    (add-tool server
              "test"
              "A simple test tool"
              (alexandria:alist-hash-table
               '(("type" . "object")
                 ("properties" . ())
                 ("required" . ())))
              (lambda (args)
                (declare (ignore args))
                (list (alexandria:alist-hash-table
                       '(("type" . "text")
                         ("text" . "Test successful!"))))))
    
    (format t "✅ MCP server created successfully!~%")
    (format t "✅ Test tool added successfully!~%")
    (format t "✅ 40ants-slynk loaded successfully!~%")
    (format t "✅ All systems working correctly!~%")
    (format t "~%You can now run:~%")
    (format t "  ./examples/simple-server.ros~%")
    (format t "  SLYNK_PORT=4005 ./examples/simple-server.ros  # With SLYNK debugging~%"))) 